# syntax=docker/dockerfile:1.11
# This file is generated by Dofigen v0.0.0
# See https://github.com/lenra-io/dofigen

LABEL \
    io.dofigen.version="0.0.0" \
    org.opencontainers.image.base.name="docker.io/eclipse-temurin:21-jre-alpine"

# maven-builder
FROM maven:3-eclipse-temurin-21-alpine AS maven-builder
WORKDIR /app
COPY \
    --link \
    "." "./"
USER 0:0
RUN \
    --mount=type=cache,target=/root/.m2,uid=0,gid=0,sharing=locked \
    --mount=type=cache,target=/app/target,uid=0,gid=0,sharing=locked \
    <<EOF
mvn package -DskipTests
mv target/*.jar app.jar
EOF

# runtime
FROM eclipse-temurin:21-jre-alpine AS runtime
COPY \
    --from=maven-builder \
    --chown=1000:1000 \
    --link \
    "/app/app.jar" "app.jar"
USER 1000:1000
CMD ["java", "-jar", "app.jar"]
