effective: |
  context:
  - /src
  - /Cargo.*
  builders:
    muslrust:
      fromImage:
        path: clux/muslrust
        digest: sha256:30d96e0daad305d68fe1798398d5ad92b92e4c4800e42b087d51a34adc340ca2
      workdir: /app
      env:
        CARGO_TARGET: x86_64-unknown-linux-musl
        APP_NAME: dofigen
        BUILD_ARGS: -F cli
      run:
      - cargo build --release ${BUILD_ARGS}
      - mv target/${CARGO_TARGET}/release/${APP_NAME} /tmp/
      cache:
      - target: /home/rust/.cargo
      - target: /app/target
      bind:
      - target: Cargo.toml
        source: Cargo.toml
      - target: Cargo.lock
        source: Cargo.lock
      - target: src/
        source: src/
  copy:
  - fromBuilder: muslrust
    paths:
    - /tmp/dofigen
    target: /bin/
  entrypoint:
  - dofigen
  cmd:
  - --help
images:
  registry.hub.docker.com:443:
    clux:
      muslrust:
        stable:
          digest: sha256:30d96e0daad305d68fe1798398d5ad92b92e4c4800e42b087d51a34adc340ca2
resources:
  dofigen.yml:
    hash: cc0ff896afbfb5e7c0d6c40eb6b282546cd7ff263c9beffff40fa4eec9756e9b
    content: "extend:\n  - https://raw.githubusercontent.com/lenra-io/dofigen-hub/muslrust/rust/muslrust.builder.yml\n\nbuilders:\n  muslrust:\n    # REPLACE those with args when it's available\n    env: \n      APP_NAME: dofigen\n      BUILD_ARGS: -F cli\n\n# Runtime\ncopy:\n  - fromBuilder: muslrust\n    paths: \"/tmp/dofigen\"\n    target: \"/bin/\"\nentrypoint: dofigen\ncmd: --help\n"
  https://raw.githubusercontent.com/lenra-io/dofigen-hub/muslrust/rust/muslrust.builder.yml:
    hash: e2d9f8fd2cd03c9f427c0eb49f91b6449b01eb35686a6acd9fedd3effc49b077
    content: "context:\n  - \"/src\"\n  - \"/Cargo.*\"\nbuilders:\n  muslrust:\n    fromImage: clux/muslrust:stable\n    env: \n      CARGO_TARGET: x86_64-unknown-linux-musl\n    workdir: /app\n    bind:\n      - Cargo.toml\n      - Cargo.lock\n      - src/\n    run:\n      # Build with musl to work with scratch\n      - cargo build --release ${BUILD_ARGS}\n      # copy the generated binary outside of the target directory. If not the other stages won't be able to find it since it's in a cache volume\n      - mv target/${CARGO_TARGET}/release/${APP_NAME} /tmp/\n    cache:\n      # Cargo cache\n      - /home/rust/.cargo\n      # build cache\n      - /app/target\n"
